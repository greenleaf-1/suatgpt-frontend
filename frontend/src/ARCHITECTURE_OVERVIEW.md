# 🏗️ 系统架构概览

## 📊 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                      前端 (React)                            │
│                    ✅ 已完成准备                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │ AI聊天   │  │ 学习中心 │  │ 通知中心 │  │ 个人中心 │   │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘   │
│       │             │              │             │          │
│       └─────────────┴──────────────┴─────────────┘          │
│                          │                                   │
│                   ┌──────▼──────┐                           │
│                   │  API调用层   │ (/utils/api-new.ts)      │
│                   │  (已完成)    │                          │
│                   └──────┬──────┘                           │
│                          │                                   │
│              ┌───────────┴───────────┐                      │
│              │                       │                      │
│        ┌─────▼─────┐          ┌─────▼─────┐               │
│        │ Mock数据  │          │ 真实API   │               │
│        │  (当前)   │          │  (待对接)  │               │
│        └───────────┘          └─────┬─────┘               │
└────────────────────────────────────────┬───────────────────┘
                                          │
                                          │ HTTP请求
                                          │ (JWT Token)
                                          │
┌─────────────────────────────────────────▼───────────────────┐
│                   后端 (Spring Boot)                         │
│                    ⏳ 待实现                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐     │
│  │ 认证Controller│  │ 学生Controller│  │ 教师Controller│     │
│  │  (2个接口)   │  │  (4个接口)   │  │  (10个接口)  │     │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘     │
│         │                 │                  │              │
│         └─────────────────┴──────────────────┘              │
│                          │                                   │
│                   ┌──────▼──────┐                           │
│                   │ Service层   │                           │
│                   │ (业务逻辑)  │                           │
│                   └──────┬──────┘                           │
│                          │                                   │
│                   ┌──────▼──────┐                           │
│                   │Repository层 │                           │
│                   │  (JPA)      │                           │
│                   └──────┬──────┘                           │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           │ SQL查询
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                    数据库 (MySQL)                            │
│                    ⏳ 待创建                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  students        teachers       courses      notifications  │
│  homework        chapters       chat_history ...            │
│                    (共9个表)                                 │
└─────────────────────────────────────────────────────────────┘

                           │
                           │ (独立调用)
                           │
┌──────────────────────────▼──────────────────────────────────┐
│                    AI服务 (内网)                             │
│                    ✅ 已配置                                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Qwen3-30B-A3B         Deepseek-R1         Embedding        │
│  (主要对话)            (复杂推理)          (语义搜索)        │
│                                                              │
│  http://10.22.18.12:40011  (校园网内网)                     │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔄 数据流示例

### 示例1：学生登录

```
1. 用户输入学号密码
   └─> 前端: StudentLogin组件

2. 调用登录API
   └─> /utils/api-new.ts: studentLogin()
   
3. 当前Mock模式：
   └─> 返回Mock Token和用户数据
   └─> 存储到localStorage

4. 对接后真实流程：
   └─> POST /api/auth/student/login
   └─> 后端验证密码
   └─> 生成JWT Token
   └─> 返回Token + 用户信息
   └─> 前端存储Token
```

### 示例2：查看课程列表

```
1. 用户点击学习中心
   └─> 前端: LearningCenter组件

2. 加载课程数据
   └─> /utils/api-new.ts: getCourses()

3. 当前Mock模式：
   └─> 返回硬编码的3门课程

4. 对接后真实流程：
   └─> GET /api/student/courses
   └─> Header: Authorization: Bearer {token}
   └─> 后端验证Token
   └─> 查询数据库：student_courses表
   └─> 返回该学生的课程列表
```

### 示例3：AI对话（特殊）

```
1. 用户发送消息
   └─> 前端: AIChat组件

2. 直接调用AI服务（不经过后端）
   └─> /utils/ai-service.ts: askQuestion()
   └─> 直接HTTP请求到内网AI
   └─> http://10.22.18.12:40011/v1/chat/completions
   └─> 获取AI回复

3. 保存聊天记录（可选）
   └─> /utils/api-new.ts: saveChatMessage()
   └─> POST /api/ai/chat (后端)
   └─> 存储到chat_history表
```

---

## 📦 模块依赖关系

### 前端模块

```
App.tsx
├── AdminDashboard (教师端)
│   ├── 学生管理
│   ├── 课程管理
│   ├── 作业管理
│   └── 通知推送
│
└── 学生端
    ├── AIChat (AI聊天)
    ├── LearningCenter (学习中心)
    │   └── CourseDetail (课程详情)
    │       └── HomeworkSection (作业)
    ├── NotificationCenter (通知)
    └── PersonalCenter (个人)

所有模块都依赖：
└── /utils/api-new.ts (API调用层)
    └── /utils/api-config.ts (配置)
```

### 后端模块（待实现）

```
Controller层 (接收HTTP请求)
├── AuthController (认证)
├── StudentController (学生端)
├── CourseController (课程)
├── AdminController (管理端)
└── AIController (AI聊天记录)

↓

Service层 (业务逻辑)
├── AuthService (JWT生成/验证)
├── StudentService
├── CourseService
├── HomeworkService
├── NotificationService
└── ChatService

↓

Repository层 (数据访问)
├── StudentRepository
├── TeacherRepository
├── CourseRepository
├── HomeworkRepository
├── NotificationRepository
└── ChatHistoryRepository

↓

Entity层 (数据库映射)
├── Student.java
├── Teacher.java
├── Course.java
├── Homework.java
└── ... (共9个)
```

---

## 🔐 认证流程

```
┌─────────────┐
│   用户登录   │
└──────┬──────┘
       │
       ▼
┌─────────────────────────┐
│  前端发送用户名密码      │
│  POST /auth/login       │
└──────┬──────────────────┘
       │
       ▼
┌─────────────────────────┐
│  后端验证密码 (BCrypt)   │
└──────┬──────────────────┘
       │
       ├─── 验证失败 ───> 返回401错误
       │
       └─── 验证成功 ───┐
                       │
                       ▼
            ┌─────────────────────┐
            │  生成JWT Token      │
            │  包含：userId, role │
            └──────┬──────────────┘
                   │
                   ▼
            ┌─────────────────────┐
            │  返回Token + 用户信息│
            └──────┬──────────────┘
                   │
                   ▼
            ┌─────────────────────┐
            │ 前端存储Token到      │
            │ localStorage        │
            └─────────────────────┘

后续所有请求：
┌─────────────────────────┐
│  GET /api/xxx           │
│  Header:                │
│  Authorization: Bearer  │
│  {token}                │
└──────┬──────────────────┘
       │
       ▼
┌─────────────────────────┐
│  后端验证Token           │
│  提取userId             │
└──────┬──────────────────┘
       │
       ├─── 无效/过期 ───> 返回401
       │
       └─── 有效 ───> 处理请求
```

---

## 📊 数据库关系图

```
┌──────────┐         ┌──────────┐         ┌──────────┐
│ students │◄────────┤student_  │────────►│ courses  │
│          │         │courses   │         │          │
│ - id     │         │          │         │ - id     │
│ - name   │         │- progress│         │ - name   │
│ - major  │         └──────────┘         │ - teacher│
└────┬─────┘                              └────┬─────┘
     │                                          │
     │                                          │
     │ 1:N                                 1:N  │
     │                                          │
     ▼                                          ▼
┌──────────┐                            ┌──────────┐
│homework_ │                            │ homework │
│submissio │                            │          │
│ns        │                            │ - id     │
│          │◄───────────────────────────┤ - title  │
│- score   │         N:1                │ - course │
│- status  │                            └──────────┘
└──────────┘

     ▲
     │ 1:N
     │
┌────┴─────┐
│ students │
│          │
│          │
└────┬─────┘
     │ 1:N
     ▼
┌──────────┐
│notifica- │
│tions     │
│          │
│- title   │
│- content │
└──────────┘

     ▲
     │ 1:N
     │
┌────┴─────┐
│ students │
│          │
└────┬─────┘
     │ 1:N
     ▼
┌──────────┐
│chat_     │
│history   │
│          │
│- content │
│- role    │
└──────────┘

┌──────────┐
│ teachers │
│          │
│ - id     │
│ - name   │
└────┬─────┘
     │ 1:N
     ▼
┌──────────┐
│ courses  │
│          │
└────┬─────┘
     │ 1:N
     ▼
┌──────────┐
│ chapters │
│          │
│- sections│
└──────────┘
```

---

## 🚀 部署架构（未来）

```
┌─────────────────────────────────────┐
│         云服务器 / 本地服务器          │
├─────────────────────────────────────┤
│                                      │
│  ┌──────────────┐  ┌──────────────┐│
│  │   Nginx      │  │   Nginx      ││
│  │  (反向代理)   │  │   (静态)     ││
│  │  :80 -> :8080│  │   :80 -> SPA ││
│  └──────┬───────┘  └──────┬───────┘│
│         │                  │        │
│         │                  │        │
│  ┌──────▼───────┐  ┌──────▼───────┐│
│  │Spring Boot   │  │React Build   ││
│  │  :8080       │  │  (静态文件)   ││
│  └──────┬───────┘  └──────────────┘│
│         │                           │
│  ┌──────▼───────┐                  │
│  │  MySQL       │                  │
│  │  :3306       │                  │
│  └──────────────┘                  │
│                                     │
└─────────────────────────────────────┘
        │
        │ (校园网内网)
        ▼
┌─────────────────┐
│   AI服务器       │
│  10.22.18.x     │
└─────────────────┘
```

---

## 📝 开发时序

```
第1周：后端开发 ✅
├── Day 1-2: 项目搭建、数据库设计
├── Day 3-4: 实现核心API
├── Day 5-6: 实现管理端API
└── Day 7: 测试、文档

第2周：前后端对接 ⏳
├── Day 1: 配置对接
├── Day 2-3: 功能测试
├── Day 4-5: Bug修复
└── Day 6-7: 优化、完善

第3周：完善与部署
├── 添加更多功能
├── UI优化
└── 准备演示
```

---

## 🎯 当前状态总结

| 模块 | 状态 | 完成度 |
|------|------|--------|
| 前端UI | ✅ 完成 | 100% |
| 前端API层 | ✅ 完成 | 100% |
| Mock数据 | ✅ 可用 | 100% |
| AI集成 | ✅ 完成 | 100% |
| 后端API | ⏳ 待开发 | 0% |
| 数据库 | ⏳ 待创建 | 0% |
| 前后端对接 | ⏳ 待测试 | 0% |
| **总体进度** | **60%** | **60%** |

---

**下一步：实现Java后端！** 🚀
